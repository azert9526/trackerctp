(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5373:(e,t,l)=>{Promise.resolve().then(l.bind(l,1451)),Promise.resolve().then(l.bind(l,8998)),Promise.resolve().then(l.bind(l,9552)),Promise.resolve().then(l.bind(l,6805)),Promise.resolve().then(l.bind(l,810)),Promise.resolve().then(l.bind(l,8882)),Promise.resolve().then(l.bind(l,9785))},8882:(e,t,l)=>{"use strict";l.d(t,{default:()=>a});var o=l(5155),i=l(4826),s=l(2679),n=l(457);l(2115);let r=(0,i.A)({palette:{mode:"dark"}});function a(e){let{children:t}=e;return(0,o.jsxs)(s.A,{theme:r,children:[(0,o.jsx)(n.Ay,{}),t]})}},9785:(e,t,l)=>{"use strict";l.d(t,{default:()=>D});var o=l(5155),i=l(2115),s=l(9047);let n=["places","drawing","geometry"];function r(e){let{children:t}=e,{isLoaded:l,loadError:i}=(0,s.KD)({googleMapsApiKey:"AIzaSyDc8Y7sBvZTfC4PLc8xX8XwhVxmkU9dXJY",libraries:n});return i?(0,o.jsx)("p",{children:"Encountered error while loading google maps"}):l?t:(0,o.jsx)("p",{children:"Map Script is loading ..."})}function a(e,t){let l=e.replace(/[^\d]+$/,""),o=t.replace(/[^\d]+$/,""),i=Number(l),s=Number(o);if(i==s){if(l!=e)return 1;if(o!=t)return -1}return i-s}function d(e,t){return{x:-(e/2),y:-(t/2)}}var c=l(979),p=l(2282);function u(e){let{favouriteRoutes:t,onButtonPress:l}=e;return(0,o.jsx)(c.A,{spacing:2,direction:"row",children:t.map(e=>(0,o.jsxs)(p.A,{variant:"contained",onClick:()=>{l(e)},children:[" ",e," "]},e))})}var f=l(8998),h=l(507),y=l(5480),m=l(8130),x=l(1254);let g={1:"1",3:"22",4:"36",5:"49","5n":"153",6:"53",7:"54",9:"58",14:"120",19:"6",21:"8",23:"10","24b":"13",25:"14","25n":"15",27:"18","28b":"20","29s":"116",30:"23",31:"24",32:"25","32b":"26",33:"27",34:"28",35:"29","36b":"30","36l":"31","39l":"35",43:"41","43b":"42","43p":"43",44:"114",45:"113","46b":"45","46l":"44",47:"46",48:"47","48l":"48",50:"50",52:"63","54n":"152",101:"3",102:"4"},v=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}],_=[...v,{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]}];function j(e){let{routeValue:t="",onRouteChange:l}=e;return(0,o.jsx)(f.default,{sx:{minWidth:90,maxWidth:120},children:(0,o.jsxs)(m.A,{fullWidth:!0,children:[(0,o.jsx)(h.A,{id:"route-select-label",children:"Route"}),(0,o.jsx)(x.A,{labelId:"route-simple-select-label",id:"route-simple-select",value:t,label:"Route",onChange:e=>{l(e.target.value)},sx:{textAlign:"center"},children:Object.keys(g).toSorted(a).map(e=>(0,o.jsx)(y.A,{value:e,sx:{textAlign:"center"},children:e},e))})]})})}var b=l(7097),T=l(6757);function A(e){let{isRouteFavourite:t,addFavourite:l}=e;return(0,o.jsx)(p.A,{"aria-label":"favourite",onClick:l,sx:{minWidth:0},children:t?(0,o.jsx)(b.A,{}):(0,o.jsx)(T.A,{})})}function S(e){let{route:t,favourites:l,onRouteChange:i,addFavourite:s}=e;return(0,o.jsxs)(c.A,{spacing:2,children:[(0,o.jsx)(u,{favouriteRoutes:l,onButtonPress:i}),(0,o.jsxs)(c.A,{spacing:1,direction:"row",children:[(0,o.jsx)(j,{routeValue:t,onRouteChange:i}),(0,o.jsx)(A,{isRouteFavourite:l.includes(t),addFavourite:s})]})]})}var k=l(6681);function P(e,t){return t&&t.length?t.flat().filter(t=>t.shape_id===e).sort((e,t)=>e.shape_pt_sequence-t.shape_pt_sequence).map(e=>({lat:e.shape_pt_lat,lng:e.shape_pt_lon})):(console.warn("Shapes data is not available"),[])}function C(e,t,l,o){let i=(l-e)*Math.PI/180,s=(o-t)*Math.PI/180,n=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*6371}function w(e,t,l,o){let i=P(l,o);if(!i)return null;let s=1/0,n=null,r=0;if(i.forEach((l,o)=>{let i=C(l.lat,l.lng,e,t);i<s&&(s=i,n=o)}),null!==n)for(let e=0;e<n;e++){let{lat:t,lng:l}=i[e],{lat:o,lng:s}=i[e+1];r+=C(t,l,o,s)}return r}var E=l(894),I=l(1312),M=l(2251),N=l(7240),O=l(7047),R=l(2479),L=l(810),W=l(9841),z=l(4665),F=l(6036);function B(e){let{data:t,clicked:l,handleBusClick:i,handleEstimateTimeButtonClick:n}=e;return(0,o.jsx)(s.P3,{mapPaneName:s.i3.OVERLAY_MOUSE_TARGET,position:t.position,getPixelPositionOffset:d,zIndex:l?10:0,children:(0,o.jsxs)(c.A,{sx:{justifyContent:"center",alignItems:"center"},children:[l&&(0,o.jsx)(F.A,{alignItems:"center",justifyItems:"center",sx:{minWidth:200,position:"absolute",bottom:"100%"},children:(0,o.jsxs)(z.A,{variant:"outlined",children:[(0,o.jsxs)(R.A,{children:[(0,o.jsxs)(L.default,{variant:"h5",children:[" ","Nr. ".concat(t.id)," "]}),(0,o.jsx)(L.default,{gutterBottom:!0,sx:{color:"text.secondary",fontSize:12},children:"".concat(t.speed," km/h")}),(0,o.jsx)(L.default,{sx:{color:"text.secondary",fontSize:12},children:" Previous stop: "}),(0,o.jsxs)(L.default,{variant:"body2",children:[" ",t.previousStopName," "]}),(0,o.jsx)(L.default,{sx:{color:"text.secondary",fontSize:12},children:" Next stop: "}),(0,o.jsxs)(L.default,{variant:"body2",children:[" ",t.nextStopName," "]})]}),(0,o.jsx)(W.A,{sx:{justifyContent:"center",alignItems:"center"},children:(0,o.jsx)(p.A,{size:"small",variant:"contained",onClick:n,children:"Estimate time"})})]})}),(0,o.jsx)(E.A,{"aria-label":"bus",onClick:()=>i(t),children:(0,o.jsx)(O.A,{style:{color:t.color}})})]})})}var G=l(6331),J=l(4107);function V(e){return e.id.toString()+e.color}let Y={width:"100%",height:"75vh",borderRadius:"15px 0px 0px 15px"},q={lat:46.7712,lng:23.5966},H={mapTypeId:"roadmap",streetViewControl:!1,mapTypeControl:!1,gestureHandling:"greedy"},X={strokeColor:"#FF0000",strokeOpacity:.5,strokeWeight:6},K={strokeColor:"#00FF00",strokeOpacity:.5,strokeWeight:4};function U(e){var t;let{route:l="",stopLocations:n,tripStops:r,shapes:a,busLocations:p,userLocation:u}=e,{stopPositions:f,firstGreen:h}=function(e,t,l){if(!e)return{stopPositions:[],firstGreen:-1};let o=e+"_0",i=e+"_1",s=[];t.filter(e=>e.trip_id===o||e.trip_id===i).forEach(e=>{let t=l.find(t=>t.stop_id===e.stop_id);t&&s.push({id:t.stop_id,position:{lat:t.stop_lat,lng:t.stop_lon},color:e.trip_id.endsWith("_0")?"red":"green"})});let n=s.findIndex(e=>"green"===e.color);return{stopPositions:s,firstGreen:n}}(g[l],n,r),[y,m]=(0,i.useState)([]),[x,j]=(0,i.useState)([]),b=(t=g[l],p&&t?p.flat().filter(e=>{var l;return(null===(l=e.route_id)||void 0===l?void 0:l.toString())===t&&null!==e.trip_id&&(e.trip_id.endsWith("_0")||e.trip_id.endsWith("_1"))}).map(e=>(function(e,t,l){var o,i;let s={id:e.label,tripId:e.trip_id,position:{lat:e.latitude,lng:e.longitude},color:e.trip_id.endsWith("_0")?"red":"green"},n=l.filter(t=>t.trip_id===e.trip_id),r=n.find(e=>0===e.stop_sequence);if(!r)return console.warn("Stop distances could not be calculated."),s;let a=t.find(e=>e.stop_id===r.stop_id),d=n.map(e=>{let l=t.find(t=>t.stop_id===e.stop_id);return l?{stop:e,distance:C(a.stop_lat,a.stop_lon,l.stop_lat,l.stop_lon)}:null}).filter(e=>null!==e),c=C(a.stop_lat,a.stop_lon,e.latitude,e.longitude);d.push({stop:{stop_id:"vehicle",stop_lat:e.latitude,stop_lon:e.longitude},distance:c}),d.sort((e,t)=>e.distance-t.distance);let p=d.findIndex(e=>"vehicle"===e.stop.stop_id),u=p>0?d[p-1].stop:{stop_id:null},f=p<d.length-1?d[p+1].stop:{stop_id:null},h=(null===(o=t.find(e=>e.stop_id===u.stop_id))||void 0===o?void 0:o.stop_name)||"At first stop",y=(null===(i=t.find(e=>e.stop_id===f.stop_id))||void 0===i?void 0:i.stop_name)||"At last stop";return{...s,speed:e.speed,previousStopName:h,nextStopName:y}})(e,r,n)):[]);(0,i.useEffect)(()=>{m([]),j([]),m(P(g[l]+"_0",a)),j(P(g[l]+"_1",a))},[l]);let[T,A]=(0,i.useState)(null),S=e=>{A((null==T?void 0:T.id)===e.id?null:e)},[O,R]=(0,i.useState)(!1),[L,W]=(0,i.useState)(q),[z,F]=(0,i.useState)(!1),U=()=>{F(!0)},D=async e=>{let t=e.lat(),l=e.lng();F(!1);let o=performance.now(),i=Math.round(1e3*w(T.position.lat,T.position.lng,T.tripId,a))/1e3,s=Math.round(1e3*w(t,l,T.tripId,a))/1e3;console.log("started ",i,s);let n=await fetch("https://trackerctp.onrender.com/predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trip_id:T.tripId,d1:i,d2:s})}),r=await n.json();console.log("responded");let d=(performance.now()-o)/1e3,c=parseFloat(r.predicted_time)-d,p=Math.floor(c/60),u=Math.floor(c%60);alert("Predicted time from selected vehicle to clicked point is ".concat(p," minutes and ").concat(u," seconds."))};return(0,o.jsxs)("div",{className:"w-full",style:{position:"relative"},children:[(0,o.jsxs)(c.A,{style:{position:"absolute",top:"8px",left:"8px",zIndex:10},children:[(0,o.jsx)(E.A,{"aria-label":"Center on my location",onClick:()=>{u&&W(u)},children:(0,o.jsx)(G.A,{id:"button-center",title:"Center on my location",children:(0,o.jsx)(N.A,{})})}),(0,o.jsx)(E.A,{"aria-label":"Hide/Show Map Elements",onClick:()=>{R(e=>!e)},children:(0,o.jsx)(G.A,{id:"hide-show-map-elements",title:O?"Hide Map Elements":"Show Map Elements",children:O?(0,o.jsx)(I.A,{}):(0,o.jsx)(M.A,{})})})]}),(0,o.jsxs)(s.u6,{mapContainerStyle:Y,center:L,zoom:14,options:{...H,styles:O?v:_},children:[f.map((e,t)=>(0,o.jsx)(s.P3,{mapPaneName:s.i3.OVERLAY_LAYER,position:e.position,getPixelPositionOffset:d,zIndex:0===t?1:0,children:0===t||t===h?(0,o.jsx)(J.A,{style:{color:e.color,minWidth:40,minHeight:40}}):(0,o.jsx)(k.A,{style:{color:e.color}})},V(e))),b.map(e=>(0,o.jsx)(B,{data:e,clicked:(null==T?void 0:T.id)===e.id,handleBusClick:S,handleEstimateTimeButtonClick:U},V(e))),u&&(0,o.jsx)(s.pH,{position:u}),(0,o.jsx)(s.Ro,{onClick:e=>{z&&"red"==T.color&&e.latLng&&D(e.latLng)},path:y,options:X}),(0,o.jsx)(s.Ro,{onClick:e=>{z&&"green"==T.color&&e.latLng&&D(e.latLng)},path:x,options:K})]})]})}function D(e){let{stopLocationsPromise:t,tripStopsPromise:l,shapesPromise:s}=e,[n,d]=(0,i.useState)([]),[p,u]=i.useState(""),[f,h]=(0,i.useState)(),[y,m]=(0,i.useState)(),[x,g]=(0,i.useState)(),[v,_]=(0,i.useState)(),[j,b]=(0,i.useState)();async function T(e){u(e)}return(0,i.useEffect)(()=>{let e=localStorage.getItem("favourites");e&&d(JSON.parse(e))},[]),(0,i.useEffect)(()=>{localStorage.setItem("favourites",JSON.stringify(n))},[n]),(0,i.useEffect)(()=>{s.then(e=>g(e.flat())),t.then(e=>h(e)),l.then(e=>m(e))},[t,l]),(0,i.useEffect)(()=>{let e=async()=>{await fetch("https://api.tranzy.ai/v1/opendata/vehicles",{method:"GET",headers:{Accept:"application/json","X-API-KEY":"1v6BK493vzooj5F97rbEcRiuAGwS0VJPPJ7fCI0U","X-Agency-Id":"2"},next:{revalidate:45}}).then(e=>e.json()).then(e=>_(e))};navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{b({lat:e.coords.latitude,lng:e.coords.longitude})},e=>{console.error("Error getting location:",e),alert("Could not retrieve your location."),b(null)}):(alert("Geolocation is not supported by this browser."),b(null)),e()},[p]),(0,o.jsxs)(c.A,{spacing:1,children:[(0,o.jsx)(S,{route:p,favourites:n,onRouteChange:T,addFavourite:function(){""!=p&&(n.includes(p)?d(e=>e.filter(e=>e!==p).toSorted(a)):d(e=>[...e,p].toSorted(a)))}}),(0,o.jsx)(r,{children:(0,o.jsx)(U,{route:p,stopLocations:f,tripStops:y,shapes:x,busLocations:v,userLocation:j})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[84,892,441,517,358],()=>t(5373)),_N_E=e.O()}]);